<!doctype html>
<html>
<head><meta charset="utf-8"><title>Opciones - Publish Nexus</title></head>
<body>
  <h3>Publish Nexus — Opciones</h3>
  <label><input type="checkbox" id="consent"> Acepto que Publish Nexus AI capture los datos visibles de la página actual y los envíe para análisis (retención 90 días).</label>
  <br><br>
  <label>Token temporal (opcional): <input id="token" placeholder="token temporal"></label>
  <p>Si no pegás token, se usará el envío anónimo limitado.</p>
  <br>
  <button id="save">Guardar</button>
  <button id="deleteAll">Borrar mis datos locales</button>
  <script>
    async function storageGet(keys) {
      return new Promise(resolve => chrome.storage.sync.get(keys, res => resolve(res||{})));
    }
    async function storageSet(obj) {
      return new Promise(resolve => chrome.storage.sync.set(obj, () => resolve()));
    }
    (async () => {
      const s = await storageGet(['consent','token']);
      document.getElementById('consent').checked = !!s.consent;
      document.getElementById('token').value = s.token || '';
    })();

    document.getElementById('save').addEventListener('click', async () => {
      const consent = document.getElementById('consent').checked;
      const token = document.getElementById('token').value.trim();
      if (!consent) return alert('Debés aceptar la política para usar la extensión.');
      await storageSet({ consent, token });
      alert('Guardado');
    });

    document.getElementById('deleteAll').addEventListener('click', async () => {
      if (!confirm('Borrarás todos tus datos locales. ¿Querés continuar?')) return;
      await new Promise(r=> chrome.storage.sync.clear(r));
      alert('Datos borrados localmente.');
    });
  </script>
</body>
</html>