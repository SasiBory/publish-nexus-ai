<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Publish Nexus</title>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
        --pnx-ink: #1B263B;
        --pnx-amber: #FFB84D;
        --pnx-light: #F5F5F5;
        --pnx-green: #2A9D8F;
    }
    body {
      width: 300px;
      font-family: 'Sora', sans-serif;
      background: var(--pnx-light);
      color: var(--pnx-ink);
      text-align: center;
      padding: 20px;
    }
    h3 {
      font-weight: 700;
      font-size: 18px;
    }
    p {
      font-size: 14px;
      margin: 15px 0;
    }
    a {
      color: var(--pnx-green);
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h3>Publish Nexus AI</h3>
  <p id="info">Verificando estado...</p>
  <a id="open-options">Ir a Opciones</a>

  <script>
    async function storageGet(keys) {
      return new Promise(resolve => chrome.storage.sync.get(keys, res => resolve(res || {})));
    }

    const optionsLink = document.getElementById('open-options');
    if (optionsLink) {
        optionsLink.addEventListener('click', () => {
            chrome.runtime.openOptionsPage();
        });
    }

    (async () => {
      const infoEl = document.getElementById('info');
      const { consent, captures_day = 0, captures_date } = await storageGet(['consent', 'captures_day', 'captures_date']);
      const today = new Date().toISOString().slice(0, 10);

      if (!consent) {
        infoEl.innerHTML = 'Por favor, acepta la política de privacidad en la <a id="open-options-inner">página de opciones</a> para empezar a capturar.';
        const innerLink = document.getElementById('open-options-inner');
        if (innerLink) {
            innerLink.addEventListener('click', () => {
                chrome.runtime.openOptionsPage();
            });
        }
        return;
      }

      const dailyCaptures = captures_date === today ? captures_day : 0;
      infoEl.innerHTML = `Estás listo para capturar.<br><br>Haz clic en el icono de la extensión en una página de producto de Amazon.<br><br>Capturas hoy: <strong>${dailyCaptures} / 150</strong>`;
    })();
  </script>
</body>
</html>